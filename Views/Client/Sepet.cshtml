
@{
    ViewBag.Title = "Sepet";
    Layout = "~/Views/Client/Layout/_Layout.cshtml";
}

<center>
    <br />
    <h2><span>Yolda</span> <span class="text-warning"> Sepet</span></h2>
    <br />
    <hr />
</center>


<div class="row">
    <div class="col-12 col-lg-8 col-xl-8">
        <div class="card">
            <div class="card-header border-0">
                Sepetim
            </div>
            <div class="table-responsive">
                <table class="table align-items-center table-flush">
                    <thead>

                        <tr>

                            <th>Ürün</th>
                            <th>Adet</th>
                            <th>Fıyat</th>
                            <th>Ürünü Sil</th>

                        </tr>
                    </thead>

                    <tbody>

                        @foreach (tst_MVC1.Models.tstYemekSepet1 item in ViewBag.Sepet)
                        {
                            string Sil = "SepetSil" + item.id;

                            <tr>


                                <td>@item.YemekAdi</td>
                                <td>@item.Adet</td>
                                <td>@item.Fiyat ₺</td>

                                <td><a href="/Sepet/SepetSil/@item.id" class="btn btn-outline-danger btn-sm text-white"><i class="icon-trash"></i> Sil</a></td>

                            </tr>

                        }

                        <tr>

                            <td>Toplam Fiyat :</td>
                            <td></td>
                            <td>@ViewBag.ToplamFiyat ₺</td>
                            <td></td>

                        </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="card">

            <div class="card-body">
                <center>
                    <h4 class="card-title" id="baslik">Satın Alım</h4>

                    <p></p>
                    <div id="fiyat">
                        <h5 class="text-warning">@ViewBag.ToplamFiyat ₺</h5>
                    </div>

                    <p id="error" hidden>Lütfen Sepetinize Birşeyler Ekleyiniz!</p>

                    <div id="buton">
                        <hr />
                        <button data-toggle="modal" data-target="#SatınAl" class="btn btn-success btn-sm text-white"> Satın Al</button>
                    </div>

                    <div class="progress-wrapper" id="anim" hidden>
                        <hr />

                        <p>
                            <i id="box" class="icon-social-dropbox" style="position:absolute; left:5%"></i>

                            <div id="truck">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16" style="position:absolute; left:26%">
                                    <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456zM12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12v4zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" />
                                </svg>
                            </div>

                            <div id="door">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-door-closed" viewBox="0 0 16 16" style="position:absolute; left:69%">
                                    <path d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z" />
                                    <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z" />
                                </svg>
                            </div>

                            <i id="check" class="icon-check" style="position:absolute; left:91%"></i>

                            <br />
                        </p>


                        <div class="progress mb-4" style="height:10px;">
                            <div class="progress-bar bg-info progress-bar-striped progress-bar-animated" id="bar" style="width:0%"></div>

                        </div>
                    </div>
                </center>
            </div>
        </div>
    </div>

    <div class="modal fade" id="SatınAl">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-success">
                <div class="modal-header bg-success">
                    <h5 class="modal-title text-white">Adres ve Kart Bilgileri </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" name="id" hidden />
                    <div class="form-group col-lg-12">
                        <label>Ad Soyad </label>
                        <input type="text" class="form-control" name="YemekAdi" />
                    </div>
                    <div class="form-group col-lg-12">
                        <label>Adres </label>
                        <textarea rows="3" class="form-control" id="basic-textarea" name="Aciklama"> </textarea>
                    </div>

                    <center>
                        <hr />
                        <br />
                        <h5>Kart Bilgileri</h5>

                    </center>

                    <div class="form-group col-lg-12">
                        <label>Kart Numarası </label>
                        <input type="text" class="form-control" name="YemekAdi" />
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-4">
                            <label>Kart Üzerindeki Ad Soyad </label>
                            <input type="text" class="form-control" name="YemekAdi" />
                        </div>
                        <div class="col-12 col-lg-4">

                            <label>Son Kullanma Tarihi </label>
                            <input type="text" class="form-control" name="YemekAdi" />
                        </div>
                        <div class="col-12 col-lg-4">
                            <label>CVV </label>
                            <input type="text" class="form-control" name="YemekAdi" />
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-dark" data-dismiss="modal"><i class="fa fa-times"></i> Kapat </button>
                    <a class="btn btn-outline-success" onclick="loop()" data-dismiss="modal" href="/Sepet/SepetTemizle/@ViewBag.ClientID"><i class="fa fa-save"></i> Satın Al</a>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function loop() {
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }


        async function loop2() {
            if (@ViewBag.ToplamFiyat != null) {
                document.getElementById('anim').hidden = false;
                document.getElementById('buton').hidden = true;
                document.getElementById("box").className = "icon-social-dropbox text-danger";
                let text = "";

                for (let i = 0; i <= 100; i++) {
                    await sleep(150);
                    text = i + "%";
                    document.getElementById("bar").style.width = text

                    if (i <= 25) {
                        document.getElementById("baslik").innerHTML = "Sipariş Hazırlanıyor..."
                        document.getElementById("bar").className = "progress-bar bg-danger progress-bar-striped progress-bar-animated";


                    }
                    if (i >= 25 && i <= 75) {
                        document.getElementById("baslik").innerHTML = "Sipariş Yolda..."
                        document.getElementById("bar").className = "progress-bar bg-warning progress-bar-striped progress-bar-animated";
                        document.getElementById("truck").className = "bi bi-truck text-warning";
                    }
                    if (i >= 75) {
                        document.getElementById("baslik").innerHTML = "Sipariş Kapıda..."
                        document.getElementById("bar").className = "progress-bar bg-info progress-bar-striped progress-bar-animated";
                        document.getElementById("door").className = "bi bi-door-closed text-info";
                    }
                    if (i == 100) {
                        document.getElementById("baslik").innerHTML = "Sipariş Teslim Edildi"
                        document.getElementById("bar").className = "progress-bar bg-success progress-bar-striped progress-bar-animated";
                        document.getElementById("check").className = "icon-check text-success";
                    }

                }
            }
            if (@ViewBag.ToplamFiyat == null){
                document.getElementById('error').hidden = false;
            }
           

        }
        loop2();
    }

</script>
